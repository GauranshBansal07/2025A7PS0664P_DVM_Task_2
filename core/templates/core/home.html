{% extends 'core/base.html' %}

{% block content %}

<div class="text-center mt-5 mb-5">
    <h1 class="display-4">Welcome to the Metro System ðŸš‡</h1>
    
    {% if is_open %}
        <div class="alert alert-success d-inline-block mt-3 px-4">
            <h5 class="mb-0">âœ… Service Status: OPERATIONAL</h5>
        </div>
    {% else %}
        <div class="alert alert-danger d-inline-block mt-3 px-4">
            <h5 class="mb-0">â›” Service Status: CLOSED</h5>
        </div>
    {% endif %}

    <div class="mt-4">
        {% if user.is_authenticated %}
            <a href="{% url 'buy_ticket' %}" class="btn btn-primary btn-lg px-5">ðŸŽ« Buy Ticket</a>
            <a href="{% url 'my_tickets' %}" class="btn btn-outline-secondary btn-lg px-5">My Tickets</a>
        {% else %}
            <a href="{% url 'login' %}" class="btn btn-primary btn-lg">Login to Travel</a>
        {% endif %}
    </div>
</div>

{% if graph_data %}
<style>
    /* Container for the Graph */
    #metro-network {
        width: 100%;
        height: 600px; /* Big area for the map */
        border: 1px solid #e0e0e0;
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.05);
    }
    
    .map-container {
        position: relative;
        margin-bottom: 50px;
    }
</style>

<div class="container map-container">
    <h3 class="mb-3 text-center">Network Map</h3>
    
    <div id="metro-network"></div>
    
    <p class="text-muted text-center mt-2">
        <small>ðŸ’¡ Tip: You can drag stations to rearrange the map!</small>
    </p>
</div>

<script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function() {
        // 1. Get the data directly as an Object (No quotes!)
        var data = {{ graph_data|safe }};

        // 2. Configure the Map
        if (data) {
            var options = {
                nodes: {
                    borderWidth: 2,
                    shadow: true,
                    color: { background: 'white', border: '#666' },
                    font: { size: 14, color: '#333' }
                },
                edges: {
                    width: 4,
                    shadow: false,
                    smooth: { type: "continuous", roundness: 0.2 }
                },
                physics: {
                    enabled: true,
                    stabilization: { iterations: 200 },
                    barnesHut: {
                        gravitationalConstant: -2000,
                        springConstant: 0.04,
                        springLength: 95
                    }
                },
                interaction: {
                    hover: true,
                    dragNodes: true,
                    zoomView: true,
                    dragView: true
                }
            };

            // 3. Draw the Map
            var container = document.getElementById('metro-network');
            var network = new vis.Network(container, data, options);
        }
    }); 

</script>
{% endif %}

{% endblock %}